<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen de Gastos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-responsive {
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <h1 class="text-center">Resumen de Gastos</h1>
                <div class="table-responsive">
                    <table class="table table-striped" id="resumenTabla">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Integrante</th>
                                <th scope="col">Monto Consumido</th>
                                <th scope="col">Monto Aportado</th>
                                <th scope="col">Cambio</th>
                                <th scope="col">Deuda</th>
                            </tr>
                        </thead>
                        <tbody id="resumenTable">
                            <!-- Filas se cargarán dinámicamente aquí -->
                        </tbody>
                    </table>
                </div>
                <div class="d-grid gap-2 mb-3">
                    <button type="button" class="btn btn-primary" onclick="window.location.href='table.html'">Volver</button>
                    <button type="button" class="btn btn-danger" onclick="reiniciarApp()">Reiniciar</button>
                    <button type="button" class="btn btn-success" onclick="compartirImagen()">Compartir Imagen</button>
                </div>
                <div id="imagenContainer" class="mt-4"></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const numIntegrantes = localStorage.getItem('numIntegrantes');
            const tbody = document.getElementById('resumenTable');

            for (let i = 1; i <= numIntegrantes; i++) {
                const nombreIntegrante = localStorage.getItem(`nombreIntegrante-${i}`);
                const totalConsumo = parseFloat(localStorage.getItem(`consumoIntegrante-${i}`)) || 0;
                const montoAportado = parseFloat(localStorage.getItem(`montoAportado-${i}`)) || 0;

                const row = document.createElement('tr');

                const colIntegrante = document.createElement('td');
                colIntegrante.textContent = nombreIntegrante || `Integrante ${i}`;
                row.appendChild(colIntegrante);

                const colMontoConsumido = document.createElement('td');
                colMontoConsumido.textContent = totalConsumo.toFixed(2);
                row.appendChild(colMontoConsumido);

                const colMontoAportado = document.createElement('td');
                colMontoAportado.textContent = montoAportado.toFixed(2);
                row.appendChild(colMontoAportado);

                const colCambio = document.createElement('td');
                const colDeuda = document.createElement('td');

                if (montoAportado > totalConsumo) {
                    colCambio.textContent = (montoAportado - totalConsumo).toFixed(2);
                    colDeuda.textContent = '0.00';
                } else {
                    colCambio.textContent = '0.00';
                    colDeuda.textContent = (totalConsumo - montoAportado).toFixed(2);
                }

                row.appendChild(colCambio);
                row.appendChild(colDeuda);
                tbody.appendChild(row);
            }
        });

        function reiniciarApp() {
            if (confirm('¿Estás seguro de que deseas reiniciar? Esto borrará todos los datos.')) {
                localStorage.clear();
                window.location.href = 'index.html';
            }
        }

        function compartirImagen() {
            const resumenTabla = document.getElementById('resumenTabla');
            html2canvas(resumenTabla).then(canvas => {
                canvas.toBlob(blob => {
                    const file = new File([blob], "resumen_gastos.png", { type: "image/png" });
                    
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        navigator.share({
                            files: [file],
                            title: 'Resumen de Gastos',
                            text: 'Aquí tienes el resumen de gastos.',
                        })
                        .then(() => console.log('Compartido exitosamente.'))
                        .catch(error => console.error('Error al compartir:', error));
                    } else {
                        alert('La funcionalidad para compartir no está disponible en este navegador.');
                    }
                });
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
